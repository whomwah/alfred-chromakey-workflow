<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>bundleid</key>
	<string>com.whomwah.alfred.chromakey</string>
	<key>category</key>
	<string>Productivity</string>
	<key>connections</key>
	<dict>
		<key>06C9C4A9-38CE-441A-8D06-E2F2D8B39B60</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>80E0F247-02CF-4BAA-803A-28DEAB0ACE60</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>0C263179-CA54-4D10-864C-D202ADA9DAED</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>06C9C4A9-38CE-441A-8D06-E2F2D8B39B60</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>80E0F247-02CF-4BAA-803A-28DEAB0ACE60</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>79DCDA8C-A9CA-43EF-AF5A-B8E7D16FCCFC</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
	</dict>
	<key>createdby</key>
	<string>Duncan Robertson</string>
	<key>description</key>
	<string>Your personal color theory assistant. Visualizes 9 distinct variations of any hex color in a beautiful interactive grid.</string>
	<key>disabled</key>
	<false/>
	<key>name</key>
	<string>ChromaKey Palette</string>
	<key>objects</key>
	<array>
		<dict>
			<key>config</key>
			<dict>
				<key>argumenttype</key>
				<integer>0</integer>
				<key>keyword</key>
				<string>c</string>
				<key>subtext</key>
				<string>Unlock color variations for {query}</string>
				<key>text</key>
				<string>ChromaKey</string>
				<key>withspace</key>
				<true/>
			</dict>
			<key>type</key>
			<string>alfred.workflow.input.keyword</string>
			<key>uid</key>
			<string>0C263179-CA54-4D10-864C-D202ADA9DAED</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>columncount</key>
				<integer>3</integer>
				<key>filterable</key>
				<true/>
				<key>fixedorder</key>
				<false/>
				<key>imageaspect</key>
				<integer>2</integer>
				<key>inputfile</key>
				<string></string>
				<key>inputtype</key>
				<integer>0</integer>
				<key>loadingtext</key>
				<string></string>
				<key>showsubtitles</key>
				<true/>
				<key>showtitles</key>
				<true/>
				<key>subtitlesinfooter</key>
				<false/>
				<key>titlesinfooter</key>
				<false/>
			</dict>
			<key>type</key>
			<string>alfred.workflow.userinterface.grid</string>
			<key>uid</key>
			<string>80E0F247-02CF-4BAA-803A-28DEAB0ACE60</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>concurrently</key>
				<false/>
				<key>escaping</key>
				<integer>68</integer>
				<key>script</key>
				<string>function run(argv) {
  let query = argv[0].replace('#', '').trim();
  
  if (!/^([0-9A-F]{3}){1,2}$/i.test(query)) {
    return JSON.stringify({ items: [{ title: "Invalid Hex Code" }] });
  }
  if (query.length === 3) query = query.split('').map(c =&gt; c + c).join('');

  // --- Helpers ---
  const hexToRgb = (hex) =&gt; [0, 2, 4].map(p =&gt; parseInt(hex.substring(p, p+2), 16));
  const rgbToHex = (r, g, b) =&gt; "#" + [r, g, b].map(x =&gt; Math.max(0, Math.min(255, Math.round(x))).toString(16).padStart(2, '0')).join('').toUpperCase();
  
  // HSL is better for shifting Hues (Analogous/Triadic)
  function rgbToHsl(r, g, b) {
    r /= 255, g /= 255, b /= 255;
    let max = Math.max(r, g, b), min = Math.min(r, g, b);
    let h, s, l = (max + min) / 2;
    if (max == min) { h = s = 0; } else {
      let d = max - min;
      s = l &gt; 0.5 ? d / (2 - max - min) : d / (max + min);
      if (max == r) h = (g - b) / d + (g &lt; b ? 6 : 0);
      else if (max == g) h = (b - r) / d + 2;
      else if (max == b) h = (r - g) / d + 4;
      h /= 6;
    }
    return [h, s, l];
  }

  function hslToHex(h, s, l) {
    h = (h + 1) % 1;
    const hue2rgb = (p, q, t) =&gt; {
      if (t &lt; 0) t += 1; if (t &gt; 1) t -= 1;
      if (t &lt; 1/6) return p + (q - p) * 6 * t;
      if (t &lt; 1/2) return q;
      if (t &lt; 2/3) return p + (q - p) * (2/3 - t) * 6;
      return p;
    };
    const q = l &lt; 0.5 ? l * (1 + s) : l + s - l * s;
    const p = 2 * l - q;
    return rgbToHex(hue2rgb(p, q, h + 1/3) * 255, hue2rgb(p, q, h) * 255, hue2rgb(p, q, h - 1/3) * 255);
  }

  const [r, g, b] = hexToRgb(query);
  const [h, s, l] = rgbToHsl(r, g, b);

  // --- The 9 Grid Slots ---
  // Position 5 (index 4) is the Original
  const variations = [
    { name: "Lighter Tint", hex: hslToHex(h, s, l + 0.2) },           // 1
    { name: "Analogous Left", hex: hslToHex(h - 0.08, s, l) },       // 2
    { name: "Darker Shade", hex: hslToHex(h, s, l - 0.2) },          // 3
    { name: "Muted/Desaturated", hex: hslToHex(h, s * 0.5, l) },     // 4
    { name: "ORIGINAL", hex: "#" + query.toUpperCase() },           // 5 (Center)
    { name: "Vibrant/Saturated", hex: hslToHex(h, Math.min(1, s + 0.3), l) }, // 6
    { name: "Triadic Shift", hex: hslToHex(h + 0.33, s, l) },        // 7
    { name: "Analogous Right", hex: hslToHex(h + 0.08, s, l) },      // 8
    { name: "Complement", hex: hslToHex(h + 0.5, s, l) }             // 9
  ];

  const app = Application.currentApplication();
  app.includeStandardAdditions = true;
  const tmpDir = "/tmp/alfred_colors/";
  app.doShellScript(`mkdir -p "${tmpDir}"`);

  // Path to your magick binary - update if necessary
  const magickPath = "magick"; 

  const items = variations.map((v, index) =&gt; {
    const rawHex = v.hex.replace('#', '');
    const iconPath = `${tmpDir}${rawHex}.png`;

    try {
      // Check if file exists to keep it fast
      app.doShellScript(`if [ ! -f "${iconPath}" ]; then ${magickPath} -size 128x128 xc:"${v.hex}" "${iconPath}"; fi`);
    } catch (e) {}

    return {
      title: v.hex,
      subtitle: v.name,
      arg: v.hex,
      icon: { path: iconPath }
    };
  });

  return JSON.stringify({ items });
}</string>
				<key>scriptargtype</key>
				<integer>1</integer>
				<key>scriptfile</key>
				<string></string>
				<key>type</key>
				<integer>7</integer>
			</dict>
			<key>type</key>
			<string>alfred.workflow.action.script</string>
			<key>uid</key>
			<string>06C9C4A9-38CE-441A-8D06-E2F2D8B39B60</string>
			<key>version</key>
			<integer>2</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>autopaste</key>
				<false/>
				<key>clipboardtext</key>
				<string>{query}</string>
				<key>ignoredynamicplaceholders</key>
				<false/>
				<key>transient</key>
				<false/>
			</dict>
			<key>type</key>
			<string>alfred.workflow.output.clipboard</string>
			<key>uid</key>
			<string>79DCDA8C-A9CA-43EF-AF5A-B8E7D16FCCFC</string>
			<key>version</key>
			<integer>3</integer>
		</dict>
	</array>
	<key>readme</key>
	<string></string>
	<key>uidata</key>
	<dict>
		<key>06C9C4A9-38CE-441A-8D06-E2F2D8B39B60</key>
		<dict>
			<key>xpos</key>
			<real>245</real>
			<key>ypos</key>
			<real>315</real>
		</dict>
		<key>0C263179-CA54-4D10-864C-D202ADA9DAED</key>
		<dict>
			<key>xpos</key>
			<real>80</real>
			<key>ypos</key>
			<real>90</real>
		</dict>
		<key>79DCDA8C-A9CA-43EF-AF5A-B8E7D16FCCFC</key>
		<dict>
			<key>xpos</key>
			<real>645</real>
			<key>ypos</key>
			<real>325</real>
		</dict>
		<key>80E0F247-02CF-4BAA-803A-28DEAB0ACE60</key>
		<dict>
			<key>xpos</key>
			<real>455</real>
			<key>ypos</key>
			<real>135</real>
		</dict>
	</dict>
	<key>userconfigurationconfig</key>
	<array/>
	<key>webaddress</key>
	<string>https://github.com/whomwah/alfred-chromakey-workflow</string>
</dict>
</plist>
